# Development overrides for docker-compose

services:
  gateway:
    environment:
      - LOG_LEVEL=DEBUG
      - PYTHONUNBUFFERED=1
    volumes:
      - ./services/gateway:/app/services/gateway
      - ./shared:/app/shared
    command: python -u services/gateway/main.py

  dispatcher:
    environment:
      - LOG_LEVEL=DEBUG
      - PYTHONUNBUFFERED=1
    volumes:
      - ./services/dispatcher:/app/services/dispatcher
      - ./shared:/app/shared
    command: python -u services/dispatcher/main.py

  aggregator:
    environment:
      - LOG_LEVEL=DEBUG
      - PYTHONUNBUFFERED=1
    volumes:
      - ./services/aggregator:/app/services/aggregator
      - ./shared:/app/shared
    command: python -u services/aggregator/main.py

  node:
    environment:
      - LOG_LEVEL=DEBUG
      - PYTHONUNBUFFERED=1
      - REDIS_URL=redis://redis:6379
    volumes:
      - ./services/node:/app/services/node
      - ./shared:/app/shared
    command: python -u services/node/main.py
    
  # Additional node for testing
  node-2:
    build:
      context: .
      dockerfile: services/node/Dockerfile
    container_name: synapse_node_2
    environment:
      - GATEWAY_URL=http://gateway:8080
      - NODE_ID=node-002
      - REGION=eu-west-1
      - REDIS_URL=redis://redis:6379
      - LOG_LEVEL=DEBUG
      - PYTHONUNBUFFERED=1
    depends_on:
      - gateway
      - dispatcher
    volumes:
      - ./services/node:/app/services/node
      - ./shared:/app/shared
    networks:
      - synapse_network
    command: python -u services/node/main.py
